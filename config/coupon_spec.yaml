# Default Coupon Specification for DVC Pipeline
# M3: Data Provenance and Artifact Management
#
# This is the default coupon spec used by the dvc.yaml pipeline stages.
# Schema: coupongen/schemas/coupon_spec.schema.json
# Design doc reference: Section 5.5 CouponSpec schema

schema_version: 1
coupon_family: "F1_SINGLE_ENDED_VIA"
units: nm

# Toolchain configuration - pinned for reproducibility
toolchain:
  kicad:
    version: "9.0.7"
    docker_image: "kicad/kicad:9.0.7@sha256:4ddaa54d9ead1f1b453e10a8420e0fcfba693e2143ee14b8b9c3b3c63b2a320f"

# Fabrication profile
fab_profile:
  id: "jlcpcb_4layer"
  overrides: {}

# Stackup configuration
stackup:
  copper_layers: 4
  thicknesses_nm:
    L1_to_L2: 180000
    L2_to_L3: 800000
    L3_to_L4: 180000
  materials:
    er: 4.1
    loss_tangent: 0.02

# Board outline and text
board:
  outline:
    width_nm: 20000000
    length_nm: 80000000
    corner_radius_nm: 2000000
  origin:
    mode: "EDGE_L_CENTER"
  text:
    coupon_id: "${COUPON_ID}"
    include_manifest_hash: true

# Connectors
connectors:
  left:
    footprint: "Coupongen_Connectors:SMA_EndLaunch_Generic"
    position_nm: [5000000, 0]
    rotation_deg: 180
  right:
    footprint: "Coupongen_Connectors:SMA_EndLaunch_Generic"
    position_nm: [75000000, 0]
    rotation_deg: 0

# Transmission line specification
transmission_line:
  type: "CPWG"
  layer: "F.Cu"
  w_nm: 300000
  gap_nm: 180000
  length_left_nm: 25000000
  length_right_nm: 25000000
  ground_via_fence:
    enabled: true
    pitch_nm: 1500000
    offset_from_gap_nm: 800000
    via:
      drill_nm: 300000
      diameter_nm: 600000

# Via transition discontinuity
discontinuity:
  type: "VIA_TRANSITION"
  signal_via:
    drill_nm: 300000
    diameter_nm: 650000
    pad_diameter_nm: 900000
  antipads:
    L2:
      shape: "ROUNDRECT"
      rx_nm: 1200000
      ry_nm: 900000
      corner_nm: 250000
    L3:
      shape: "CIRCLE"
      r_nm: 1100000
  return_vias:
    pattern: "RING"
    count: 4
    radius_nm: 1700000
    via:
      drill_nm: 300000
      diameter_nm: 650000
  plane_cutouts:
    L2:
      shape: "SLOT"
      length_nm: 3000000
      width_nm: 1500000
      rotation_deg: 0

# Constraints
constraints:
  mode: "REJECT"
  drc:
    must_pass: true
    severity: "all"
  symmetry:
    enforce: true
  allow_unconnected_copper: false

# Export configuration
export:
  gerbers:
    enabled: true
    format: "gerbers"
  drill:
    enabled: true
    format: "excellon"
  outputs_dir: "artifacts/"
