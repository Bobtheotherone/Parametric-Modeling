{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ParallelTaskPlan",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "milestone_id",
    "max_parallel_tasks",
    "tasks",
    "rationale"
  ],
  "properties": {
    "milestone_id": {"type": "string"},
    "max_parallel_tasks": {"type": "integer", "minimum": 1, "maximum": 32},
    "rationale": {"type": "string"},
    "tasks": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "id",
          "title",
          "description",
          "preferred_agent",
          "estimated_intensity",
          "locks",
          "touched_paths",
          "depends_on",
          "solo"
        ],
        "properties": {
          "id": {"type": "string"},
          "title": {"type": "string"},
          "description": {"type": "string"},
          "preferred_agent": {"type": "string", "enum": ["codex", "claude", "either"]},
          "estimated_intensity": {"type": "string", "enum": ["low", "medium", "high"]},
          "locks": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Named locks for exclusive access (e.g., 'config', 'database')"
          },
          "touched_paths": {
            "type": "array",
            "items": {"type": "string"},
            "description": "File paths this task will modify. Tasks with overlapping paths cannot run concurrently."
          },
          "depends_on": {"type": "array", "items": {"type": "string"}},
          "solo": {"type": "boolean"}
        }
      }
    }
  }
}
